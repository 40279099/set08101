\documentclass[10pt, a4paper, twosize]{article}
%\documentclass[12pt, a4paper, twoside]{book}

\usepackage{helvet}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{textcomp}
\usepackage[
	a4paper,
	outer=2cm,
	inner=4cm,
	top=2cm,
	bottom=2cm
]{geometry}
\usepackage{float}
\usepackage{tabularx}
\usepackage[disable]{todonotes}
\usepackage{color, soul}
\usepackage{amsmath}
\usepackage{algorithmicx}
\usepackage[noend]{algpseudocode}
\usepackage{algorithm}
\usepackage{framed}
\usepackage{subcaption}
\usepackage{titlepic}
\usepackage{fancyhdr}
\usepackage[simplified]{styles/pgf-umlcd}
\usepackage{shorttoc}
\usepackage{url}
\usepackage{paralist}

\definecolor{grey}{rgb}{0.9, 0.9, 0.9}
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{dkred}{rgb}{0.6,0,0.0}

\lstdefinestyle{DOS}
{
    backgroundcolor=\color{black},
    basicstyle=\scriptsize\color{white}\ttfamily,
    stringstyle=\color{white},
    keywords={}
}

\lstdefinestyle{makefile}
{
    numberblanklines=false,
    language=make,
    tabsize=4,
    keywordstyle=\color{red},
    identifierstyle= %plain identifiers for make
}

\lstset{
  language=Java,                % the language of the code
  basicstyle=\footnotesize\ttfamily,
  numbers=left,                   % where to put the line-numbers
  stepnumber=1,                   % the step between two line-numbers. If it's 1, each line
  numbersep=5pt,                  % how far the line-numbers are from the code
  backgroundcolor=\color{white},      % choose the background color. You must add \usepackage{color}
  showspaces=false,               % show spaces adding particular underscores
  showstringspaces=false,         % underline spaces within strings
  showtabs=false,                 % show tabs within strings adding particular underscores
  frame=single,                   % adds a frame around the code
  rulecolor=\color{black},        % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
  tabsize=2,                      % sets default tabsize to 2 spaces
  captionpos=b,                   % sets the caption-position to bottom
  breaklines=true,                % sets automatic line breaking
  breakatwhitespace=false,        % sets if automatic breaks should only happen at whitespace
  keywordstyle=\color{blue},          % keyword style
  commentstyle=\color{dkgreen},       % comment style
  stringstyle=\color{dkred},         % string literal style
  columns=fixed,
  extendedchars=true,
  frame=single,
}

%\renewcommand{\chaptername}{Topic}

% New definitions
\algnewcommand\algorithmicswitch{\textbf{switch}}
\algnewcommand\algorithmiccase{\textbf{case}}
\algnewcommand\algorithmicassert{\texttt{assert}}
\algnewcommand\Assert[1]{\State \algorithmicassert(#1)}%
% New "environments"
\algdef{SE}[SWITCH]{Switch}{EndSwitch}[1]{\algorithmicswitch\ #1\ \algorithmicdo}{\algorithmicend\ \algorithmicswitch}%
\algdef{SE}[CASE]{Case}{EndCase}[1]{\algorithmiccase\ #1}{\algorithmicend\ \algorithmiccase}%
\algtext*{EndSwitch}%
\algtext*{EndCase}%

\pagestyle{fancy}
\fancyhf{}
\fancyhead[RO, LE]{\small \rightmark}
\fancyfoot[RO, LE]{\small \thepage}

\begin{document}

%\frontmatter

\begin{titlepage}
\vspace*{5cm}
\begin{center}
\includegraphics[width=.5\textwidth]{images/EdNapUniLogoCMYK}~\\[1cm]

\textsc{\Large Edinburgh Napier University}\\[1.5cm]

\textsc{\LARGE \bfseries SET08101 Web Tech}\\[0.5cm]

\hrulefill \\[0.4cm]
{\huge \bfseries Lab 6 - Beginning Node.JS\\[0.4cm]}
\hrulefill \\[1.5cm]

\begin{minipage}{0.4\textwidth}
\begin{flushleft} \large
\textbf{Dr Simon Wells} \\
\end{flushleft}
\end{minipage}

\vfill

\end{center}
\end{titlepage}

%\shorttoc{Overview}{0}

%\setcounter{tocdepth}{2}
%\cleardoublepage
%\tableofcontents
%\listoffigures
%\listofalgorithms
%\addtocontents{toc}{~\hfill\textbf{Page}\par}

%\mainmatter

%\input{sections/labs/04_ui}

\section{Aims}
\paragraph{} At the end of the practical portion of this topic you will:

\begin{itemize}
\item 
\end{itemize}

\subsection{Introduction}
\paragraph{} We've concentrated so far on JavaScript in the browser or \emph{on the client side}. Now let's look at using JS on the server as well. We'll start by running the Node console and using it as a place to type in JS code. This is quite a powerful little tool that we can use to work with JS as just another programming language rather than hosting it in a browser linked to HTML files. We'll then look at using Node as a HTTP server, to host 

\section{Activities}

\subsection{Getting Node.JS}

\paragraph{} Download the Node.JS Windows Binary distribution (zip file) from the node.js website: \url{https://nodejs.org/en/download/}\footnote{Or directly download this zip: \url{https://nodejs.org/dist/v8.9.4/node-v8.9.4-win-x86.zip}}. Don't use the MSI download if you're on a lab machine because this might need administrative privileges to install.\\ 

\includegraphics[width=.8\textwidth]{images/node_web-download}

\paragraph{} Once you've downloaded the zip, extract it to somewhere suitable such as a folder on your H: drive or on USB stick.Don't just double click zip file but instead ensure that you've properly extracted the contents of the zip file. If you have trouble extracting the contents of the zip file then use a decent zip archive tool like 7zip\footnote{7zip portable download: \url{https://portableapps.com/apps/utilities/7-zip_portable}} instead.

\paragraph{} Once you've extracted the Node files we should have a folder containing some useful tools. The most important here is node.exe which we can use to run the Node program, but we'll get to that in the next section...

\paragraph{} If you're on a Mac then use homebrew to install Node, e.g.

\begin{lstlisting}[style=DOS]
$ brew install node
\end{lstlisting}

\paragraph{} If you're on Linux then use APT, or you're distro's package manager to install Node, e.g.

\begin{lstlisting}[style=DOS]
$ apt-get install node
\end{lstlisting}


\subsection{Node.JS Console}
\paragraph{} We can run node and use JS as just another programming language rather than as a \emph{web} programming language. That is we can write some JS and execute it without having to have an HTML file to host our code and load it into the browser. In fact, we don't even need the browser at this point, although we will quickly return to using the browser as this is a web technologies module after all.

\paragraph{} Node comes complete with a console. A place where we can type JS code and see the output immediately. Such an environment is known as REPL, a Read-Evaluate-Print-Loop environment; it reads a command, works out what to do, prints the result, then loops back to the start and reads the next thing. We can get a node REPL by double clicking the node.exe program:\\

\includegraphics[width=.8\textwidth]{images/node_executable}

\paragraph{} If all has gone well we should see a window like this:\\

\includegraphics[width=.8\textwidth]{images/node_repl}

\paragraph{} This is a place that we can type JS code into, why not give it a go? Let's start with some basic arithmetic:\\

\includegraphics[width=.8\textwidth]{images/node_repl-arithmetic}

\paragraph{} We can use ctrl+l to clear the screen at any time and ctrl+c twice to exit\footnote{We can also exit the REPL by typing .exit} from the REPL. As well as arithmetic we can also do standard JS programming, like the following:\\

\includegraphics[width=.8\textwidth]{images/node_repl-progamming}

\paragraph{} We can also do multiline input by just pressing return wherever we need to. For example, to type in a function:\\

\includegraphics[width=.8\textwidth]{images/node_repl-multi-line}

\paragraph{} This is called continuity mode, because when we press return we are allowed by the REPL to write the next line as a continuation of our previous code. When in continuity mode we will see the `...' as our prompt instead of `$>$'. You can leave continuity mode by typing `.break' if needed.

\paragraph{} Node has a bunch of useful commands that you can explore, for example, \emph{.help} which gives you information about some of the basic REPL commands. The tab key will display all the available commands. You can also use the up and down arrow keys to cycle through previous commands and lines of code that you've already typed in to stop your have to re-type things. The \emph{.save} command will enable you to save your current REPL session, and \emph{.load} will load the specified file into the Node REPL session. Ctrl+C (once) will terminate the current command and ctrl+c (twice) will exit the REPL.


\subsection{Node.JS as a JavaScript execution environment}
\paragraph{} We can load and run JS written in external files in two ways. Firstly by loading them within the REPL and secondly by passing the JS file to be executed to node.exe when we start it. Let's try both out. For convenience let's first create a simple JS file called ``hello.js'' and add the following code to it using a preferred editor:

\begin{lstlisting}
console.log('Hello Napier');
\end{lstlisting}

\paragraph{} I saved this to a subfolder of the node folder called js so that I could easily access examples. You can save your JS files wherever you like but you'll have to specify where they are to Node. Now you can start node and use the `.load' command to load and execute your external JS file, e.g.\\

\includegraphics[width=.8\textwidth]{images/node_repl_external-file}

\paragraph{} Alternatively, instead of clicking node.exe we can start Node from the command line (cmd.exe)\footnote{Go to the Start menu and type ``cmd.exe'' into the ``Search programs and files'' box.} and tell it which JS file to load as an argument to the executable. For example:\\

\includegraphics[width=.8\textwidth]{images/node_external-file}

\paragraph{} Using these techniques we can pretty much use node.exe as our own little programming platform. But there's more, so much more we can do with Node. We've barely scratched the surface...

\subsection{Node.JS as a hosting platform}
\paragraph{} In addition to hosting your server-side JavaScript, node can also host your regular HTML files. This can be a useful way to test out your site locally or to simplify your deployment. For example, to avoid having to install a full additional web-server if you already have node installed, or else to serve up a small number of static pages in addition to a web-app generation from JS. 

\paragraph{} We'll need to install the libraries that Node will use. We'll do this by opening the Windows command prompt, then navigating to the location of node.exe, but this time we're going to use the ``npm'' command:

\begin{lstlisting}[style=DOS]
$ npm install connect serve-static
\end{lstlisting}

\paragraph{} The Node Package Manager (NPM)\footnote{It's well worth visiting the NPM site \url{https://www.npmjs.com/} and doing some background reading on this technology. There are thousands of ready made packages available though the NPM.} is a way to package up and distribute JS code for use with Node. We just installed two packages, one called \emph{connect} and the other called \emph{serve-static} which we'll use to serve up our existin HTML.

\paragraph{} Now we need to create a small JS file, let's call it `server.js', to tell node how to serve our HTML:

\begin{lstlisting}
var connect = require('connect');
var serveStatic = require('serve-static');
connect().use(serveStatic(__dirname)).listen(8080, function(){ 
    console.log('Server running on 8080...');
    });
\end{lstlisting}

\paragraph{} Now we also need a small index.html to serve up, e.g.

\begin{lstlisting}
<!DOCTYPE html>
<html>
  <head><title>Hello</title></head>
  <body>
    <h1>hello</h1>
  </body>
</html>
\end{lstlisting}

\paragraph{} Put both index.html and server.js into the js folder then invoke node.js to run server.js, e.g.\\

\includegraphics[width=.8\textwidth]{images/node_serving}

\paragraph{} We should now be able to navigate to either \url{http://localhost:8080} or \url{http://127.0.0.1:8080} in our web browser and see our HTML file:\\

\includegraphics[width=.8\textwidth]{images/node_serving_hello}

\section{Next}
\paragraph{} There are a whole bunch of Node.JS libraries that we can build on so that Node can act as a complete server-side web language. These libraries will help us to construct our own web-apps and APIs so that we can generate our user interface on-the-fly based upon what our user wants. This is how many highly interactive websites function and developing skills in this area will enable us to begin the process of going beyond the (mostly-) static websites that we've developed so far. 

%\subsection{MongoDB}
%\paragraph{}

\end{document}

%\begin{framed}
%\end{framed}


%\begin{lstlisting}
%\end{lstlisting}

%\begin{lstlisting}[style=DOS]
%\end{lstlisting}


%\begin{figure}[H]
%\centering
%\includegraphics[width=0.85\textwidth]{images/nginx_exe}
%\caption{The nginx executable.}
%\label{fig:nginx_welcome}
%\end{figure}

